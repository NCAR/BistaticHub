# BistaticHub

This repository contains the "hub" software for bistatic radar operations.
Three programs live here: `BistaticHub`, `pb_fakesource`, and `vb_fakesource`.

## `BistaticHub`

This is the operational hub software with the primary job
of gathering data from the radar and the bistatic receivers, 
merging it, deriving winds, and writing data files.  In
addition, it will either forward phase information packets
from the radar to the bistatic receivers (magnetron radar operation) 
or will generate beam information packets itself and send them
to the bistatic receivers (S-Pol operation).  Finally, it sends
notices to the display program [xbistat](https://www.github.com/NCAR/xbistat)
so that it knows when 
new beams are available.

The program is in two pieces: `BistaticHub.py` and `BistaticHub`.  The
first is just a Python GUI wrapper for the second.

## `pb_fakesource`

This program simulates a bistatic receiver, generating "PIRAQ 
bistatic" beam data and sending it to the IP address given on 
the command line.  For example, 

```bash
    $ pb_fakesource 127.0.0.1
```

will send beams to 127.0.0.1.  The beams generated will correspond
in time to those generated by vb_fakesource.

## `vb_fakesource`

This program simulates a transmitting radar, generating VIRAQ-style
beams and sending them to the IP address given on the command
line.  The beams generated will correspond in time to those generated 
by pb_fakesource.


## Testing

Here's a useful test set-up that can be run on a single machine;
in this example the machine is 192.168.0.1.  We take advantage
of the fact that a machine on one network still has at least two
usable IP addresses: the address on the attached net, and the 
loopback address 127.0.0.1.

First, here's the `RcvrInfo` file:

```
	#
	# Site name: string
	# Format: VIRAQ or PIRAQ
	# Azimuth: degrees w.r.t. transmitting radar
	# Range: distance to transmitting radar in km
	# IP address: in dot notation
	#
	# Site Name	Format	Azimuth	 Range	IP Address
	#=======================================================
	Radar         VIRAQ  0.0     0.0    192.168.0.1
	Bistatic1     PIRAQ  212.0   27.2   127.0.0.1
```

And to run the test using this file, we start up a fake source for
both `Radar` and `Bistatic1`:

```bash
    $ vb_fakesource 192.168.0.1 &
    $ pb_fakesource 127.0.0.1 &
```
Note that the xx_fakesource programs take the *destination* IP
address as a parameter, and the addresses in the RcvrInfo file
are the expected *source* IP addresses. For our one-machine test,
though, the source and destination IP addresses for each "receiver"
are the same.

Next, start up the hub software:

```bash
    $ BistaticHub.py -b <data_dir> &
```

Finally, you can start up a display if you wish:

```bash
    $ ../display/xbistat &
```

When you're finished, don't forget to kill the `pb_fakesource` and
`vb_fakesource` instances. *Much* confusion can be generated if you 
try to run the test again and inadvertently have multiple copies
of either of these programs sending data to the same IP address.
